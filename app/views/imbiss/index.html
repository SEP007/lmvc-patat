<?php
    use ui\UI;
    use Scandio\lmvc\modules\assetpipeline\view\Asset;

    $commentsModel = new \models\Comments();
    $usersModel = new \models\Users();
?>

<div class="row-fluid content-header">
    <div class="span8">
        <h1><?= $restaurant->restaurant ?></h1>

        <h4><a href="<?= $app->url('Dishes::map', $restaurant->user_id) ?>"><?= $restaurant->street ?></a></h4>
        <h5><a href="tel:<?= $restaurant->phone ?>"><?= $restaurant->phone ?></a></h5>
    </div>

    <a href="<?= $app->url('Dishes::map', $restaurant->user_id) ?>">
        <div id="map-small" data-userid=<?= $restaurant->user_id ?> class="span4"></div>
    </a>
</div>

<?php
    $restaurantComments = $commentsModel->getCommentsByRestaurant($restaurant->id);
?>
<p>
    <?php if($loggedInCustomer != null):?>
        Adding comments is possible.
    <?php else :?>
        To be able to add a comment, please log in.
    <?php endif; ?>
</p>
<div>
    <ul class="expList">
        <li>
        <?php if($restaurantComments->count() == 0): ?>
        No comments
        <?php else: ?>
        Toggle comments
        <?php endif; ?>
            <ul>
            <?php foreach($restaurantComments as $restaurantComment): ?>
            <li>
                <?php
                   $userName = $usersModel->getUsernameByCustomerId($restaurantComment->created_by);
                ?>
                <p>
                <div><span>Created at </span><b><?= $restaurantComment->creation_date ?></b><span>, by </span><b><?= $userName ?></b></div>
                <div><?= $restaurantComment->description ?></div>
                </p>
            </li>
            <?php endforeach; ?>
            </ul>
        </li>
    </ul>
</div>

<div class="ios-list-wrap">
    <div class="patat-list">
        <dl>
            <dt>Current offers</dt>

            <?php if (count($advertisedDishes) > 0): ?>
            <?php foreach($advertisedDishes as $advertisedDish): ?>
                <dd class="">
                    <div class="span3 hidden-phone">
                        <a class="image" href="<?= $app->url('Dishes::map', $advertisedDish->user_id) ?>">
                            <?php if($advertisedDish->img): ?>
                            <img width=90 src="<?= Asset::image(['uploads', $advertisedDish->img], ['w' => 400, 'h' => 300]) ?>" alt="" />
                            <?php else: ?>
                            <img width=90 src="<?= Asset::image(['uploads', 'placeholder.png']) ?>" alt="" />
                            <?php endif; ?>
                        </a>
                    </div>
                    <div class="description span9">
                        <div class="row-fluid">
                            <h1>
                                <?= $advertisedDish->name ?> <span class="price"><?= $advertisedDish->price ?> €</span>
                            </h1>
                            <?php if($advertisedDish->category_id != null): ?>
                            <div class="span8">
                                <h4>
                                    <?= \models\Categories::getNameById($advertisedDish->category_id); ?>
                                </h4>
                            </div>
                            <?php endif ?>
                            <p class="span8">
                                <?= $advertisedDish->description ?>
                            </p>
                        </div>
                    </div>
                </dd>

                <?php
                    $dishComments = $commentsModel->getCommentsByDish($advertisedDish->id);
                ?>
                <p>
                    <?php if($loggedInCustomer != null):?>
                    Adding comments is possible.
                    <?php else :?>
                    To be able to add a comment, please log in.
                    <?php endif; ?>
                </p>
                <p>
                    <ul class="expList">
                        <li>
                        <?php if($dishComments->count() == 0): ?>
                        No comments
                        <?php else: ?>
                        Toggle comments
                        <?php endif; ?>
                            <ul>
                            <?php foreach($dishComments as $dishComment): ?>
                            <li>
                                <?php
                                   $userName = $usersModel->getUsernameByCustomerId($restaurantComment->created_by);
                                ?>
                                <p>
                                <div><span>Created at </span><b><?= $dishComment->creation_date ?></b><span>, by </span><b><?= $userName ?></b></div>
                                <div><?= $dishComment->description ?></div>
                                </p>
                            </li>
                            <?php endforeach; ?>
                            </ul>
                        </li>
                    </ul>
                </p>

            <?php endforeach; ?>
            <?php else: ?>
            <div class="alert alert-info">
                <strong>Sorry,</strong> we don't have any offers at the moment!
            </div>
            <?php endif; ?>
        </dl>
    </div>

    <?php if (count($groupedDishes) > 0): ?>
        <div class="row-fluid">
            <div class="pagination pagination-medium">
                <ul>
                    <?php
                        $alphabet = range('A', 'Z');

                        foreach ($alphabet as $letter) {
                            echo '<li class="active"><a href="#'.$letter.'">'.$letter.'</a></li>';
                    }
                    ?>
                </ul>
            </div>
        </div>
    <?php endif; ?>

    <div class="patat-list">
        <dl>
            <dt>More snacks</dt>

            <?php if (count($unadvertisedDishes) > 0): ?>
                <?php foreach($unadvertisedDishes as $dish): ?>
                    <dd class="">
                        <div class="span3 hidden-phone">
                            <a class="image" href="<?= $app->url('Dishes::map', $unadvertisedDishes->user_id) ?>">
                                <?php if($dish->img): ?>
                                    <img width=100 src="<?= Asset::image(['uploads', $dish->img]) ?>" alt="" />
                                <?php else: ?>
                                    <img width=100 src="<?= Asset::image(['uploads', 'placeholder.png']) ?>" alt="" />
                                <?php endif; ?>
                            </a>
                        </div>
                        <div class="description span9">
                            <div class="row-fluid">
                                <h1>
                                    <?= $dish->name ?> <span class="price"><?= $dish->price ?> €</span>
                                </h1>
                                <?php if($dish->category_id != null): ?>
                                <div class="span8">
                                    <h4>
                                        <?= \models\Categories::getNameById($dish->category_id); ?>
                                    </h4>
                                </div>
                                <?php endif ?>
                                <p class="span8">
                                    <?= $dish->description ?>
                                </p>
                            </div>
                        </div>
                    </dd>

                    <?php
                        $dishComments = $commentsModel->getCommentsByDish($dish->id);
                    ?>
                    <p>
                        <?php if($loggedInCustomer != null):?>
                        Adding comments is possible.
                        <?php else :?>
                        To be able to add a comment, please log in.
                        <?php endif; ?>
                    </p>
                    <p>
                        <ul class="expList">
                            <li>
                                <?php if($dishComments->count() == 0): ?>
                                No comments
                                <?php else: ?>
                                Toggle comments
                                <?php endif; ?>
                                <ul>
                                <?php foreach($dishComments as $dishComment): ?>
                                <li>
                                <?php
                                   $userName = $usersModel->getUsernameByCustomerId($restaurantComment->created_by);
                                ?>
                                <p>
                                <div><span>Created at </span><b><?= $dishComment->creation_date ?></b><span>, by </span><b><?= $userName ?></b></div>
                                <div><?= $dishComment->description ?></div>
                                </p>
                                </li>
                                <?php endforeach; ?>
                                </ul>
                            </li>
                        </ul>
                    </p>

                <?php endforeach; ?>
            <?php else: ?>
                <div class="alert alert-info">
                    <strong>Sorry,</strong> we don't have any snacks listed!
                </div>
            <?php endif; ?>
        </dl>
    </div>
</div>

<script type="text/javascript" charset="UTF-8" src="http://maps.google.com/maps/api/js?sensor=true"></script>

<?= UI::js(Asset::assets(['gmaps.js'])) ?>
<?= UI::js(Asset::assets(['jquery.patatmap.js'], ['path' => 'plugins'])) ?>
<?= UI::js(Asset::assets(['jquery.imbiss-index.js'], ['path' => 'views'])) ?>
<?= UI::js(Asset::assets(['jquery.expand-collapse-list.js'], ['path' => 'views'])) ?>